<!--
@license
Copyright Pierre-Yves Gicquel ReVeRIES project-->
<link rel="import" href="../../../bower_components/polymer/polymer.html">
<link rel="import" href="../../../bower_components/paper-item/paper-item.html">
<link rel="import" href="../../../bower_components/paper-listbox/paper-listbox.html">
<link rel="import" href="../../../bower_components/Sortable/Sortable.html">
<link rel="import" href="./custom-item.html">
<dom-module id="item-list">
    <template>
        <style>
        :host {
            display: block;
            width: 100%;
        }
        
        custom-item {
            display: inline-flex;
            justify-content: center;
        }
        
        custom-item:last-of-type {
            border-bottom-style: solid;
            border-bottom-width: thin;
        }

        .sortable:focus{
            outline:none;
        }
        .sortable {
            padding-top: 0px;
            display: inline-flex;
            width: 100%;
            flex-direction: column;
        }
        
        .element {
            border-style: solid;
            border-width: 1px;
            justify-content: center;
            font-family: monospace;
            font-weight: 100;
            border-bottom: none;
            color: #8D99AE;
            cursor:pointer;
        }
        
        .heading {
            width: 100%;
            height: 40px;
            border-top-left-radius: 4px;
            border-top-right-radius: 4px;
            background-color: #BBBDF6;
            justify-content: center;
            display: inline-flex;
            align-items: center;
            font-weight: bold;
        }
        </style>
        <div>
            <template restamp=true is="dom-if" if="{{hasHeading}}">
                <div class="heading">{{heading}}</div>
            </template>
            <template restamp=true is="dom-if" if="{{listname}}">
                <div class="heading">{{listname}}</div>
            </template>
            <paper-listbox style="width:100%;padding-top:0px;">
                <sortable-js id="finalList" sort=true class="sortable" group="{{groupObject}}" handle=".handle">
                    <template is="dom-if" if="{{hasHeading}}">
                        <template is="dom-repeat" items="{{items}}" as="item">
                            <custom-item name="{{item.name}}" listname={{listname}} data="{{item}}" class="element handle">
                            </custom-item>
                        </template>
                    </template>
                    <template restamp=true is="dom-if" if="{{listname}}">
                        <custom-item listname={{listname}} class="element handle">
                        </custom-item>
                    </template>
                </sortable-js>
            </paper-listbox>
        </div>
    </template>
    <script>
    (function() {
        'use strict';

        Polymer({
            is: 'item-list',
            ready: function() {
                this.$.finalList.addEventListener('move', this.itemAdded.bind(this))
                this.$.finalList.addEventListener('remove', this.itemRemoved.bind(this))
            },
            itemAdded: function(event) {
                if (event.item) {
                    event.clone.data = event.item.__data__.data
                    event.clone.name = event.item.__data__.name
                    console.log(event)
                }

            },
            itemRemoved: function(event) {
                if (event.item) {
                    event.clone.data = event.item.__data__.data
                    event.clone.name = event.item.__data__.name
                    console.log(event)
                }
            },
            _headingObserver: function(newval, oldval) {
                if (newval && typeof(newval) === 'string' && newval.length > 0) {
                    this.hasHeading = true;
                } else {
                    this.hasHeading = false;
                }
            },
            _listGroupObserver: function(newval, oldval) {
                if (newval) {
                    console.log(newval)
                    this.groupObject = JSON.parse(newval);
                }
            },


            properties: {
                items: {
                    type: Array,
                    notify: true,
                    value: [],
                },
                itemsArray: {
                    type: Array,
                    notify: true,
                    value: []
                },
                listname: {
                    type: String,
                    notify: true,
                },
                maxElement: {
                    type: Number,
                    notify: true,
                    value: 6,
                },
                listGroup: {
                    type: String,
                    notify: true,
                    observer: '_listGroupObserver'
                },
                heading: {
                    type: String,
                    notify: true,
                    value: '',
                    observer: '_headingObserver'
                }

            },



        });
    })();
    </script>
</dom-module>
