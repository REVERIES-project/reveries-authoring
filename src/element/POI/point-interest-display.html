<!--
@license
Copyright (c) 2015 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->
<link rel="import" href="../../../bower_components/polymer/polymer.html">
<link rel="import" href="../../../bower_components/paper-card/paper-card.html">
<link rel="import" href="../../../bower_components/paper-button/paper-button.html">
<link rel="import" href="../../../bower_components/iron-ajax/iron-ajax.html">
<link rel="import" href="../remove-ressource/remove-ressource.html">
<link rel="import" href="../helper/resource-header.html">
<link rel="import" href="./map-display.html">
<link rel="import" href="./one-poi-display.html">
<dom-module id="point-interest-display">
    <template>
        <style include="shared-styles">
         :host {
            display: inline-flex
        }

        ;
        .outer {
            display: inline-flex;
            flex-wrap: wrap;
        }

        paper-card {
            --paper-card-header: {
                background-color: #b2ffa6;
            }
            --paper-card-header-text: {
                width: 250px;
                overflow: hidden;
                text-overflow: ellipsis;
                white-space: nowrap;
            }
            ;
            --paper-card-actions {
                border-top: 1px solid lightgrey;
            }
            ;
            --paper-card: {
                margin-left: 15px;
                margin-bottom: 15px;
            }
            ;
        }

        .info {
            color: #737373;
            font-weight: 400;
            font-size: 16px;
            font-family: 'Roboto', 'Noto', sans-serif;
            display: inline-block;
        }

        .generalflex {
            display: inline-flex;
            flex-wrap: wrap;
            flex-direction: column;
        }

        .mediaimg {
            height: 300px;
            display: flex;
            border-radius: 3px;
            -moz-box-shadow: 6px 5px 2px #CECEB9;
            -webkit-box-shadow: 6px 5px 2px #CECEB9;
            -o-box-shadow: 6px 5px 2px #CECEB9;
            box-shadow: 6px 5px 2px #CECEB9;
            margin-bottom: 15px;
        }

        .innerdiv {
            position: relative;
            overflow: visible;
            width: 100%;
            height: 100%;
            display: inline-flex;
            flex-wrap: wrap;
        }

        map-display: {}
        </style>
        <div class="card">
            <list-generic-resource share-url='/poi' id='poiList' resource-type='poi' url='/poi'></list-generic-resource>
        </div>
    </template>
    <script>
    (function() {
        'use strict';

        Polymer({
            is: 'point-interest-display',

            ready: function() {
                this.addEventListener('resource-operation', this.updateMedia.bind(this))
            },
            updateMedia: function(message) {
                switch (message.detail.info.operation) {
                    case 'create':
                        this.$.poiList.requestElements()
                        break
                    case 'update':
                        this.$.poiList.requestElements()
                        break

                    case 'delete':
                        this.$.poiList.requestElements()
                        break

                }
            },
            showOnMap: function(event) {
                if (!(this.itemInArray(event.model.__data__.item))) {
                    this.$.gmap.showPOI(event.model.__data__.item);
                    this.push('itemsOnMap', event.model.__data__.item._id)
                } else {
                    this.$.gmap.removePOI(event.model.__data__.item);
                    this.splice('itemsOnMap', this.itemIndex(event.model.__data__.item), 1)

                }
            },
            genRemove: function(event) {
                this.itemid = event.model.item._id;
                this.$.remover.genRequest();
                if (this.itemInArray(event.model.__data__.item)) {
                    this.$.gmap.removePOI(event.model.__data__.item);
                    this.splice('itemsOnMap', this.itemIndex(event.model.__data__.item), 1)

                }
            },

            genrequest: function() {
                this.$.ajaxLoader.generateRequest();
            },

            getPhrase: function(item) {
                if (!this.itemInArray(item)) {
                    return "Show on map"
                } else {
                    return "Hide on map"
                }

            },
            itemInArray: function(item) {
                for (var i = 0; i < this.itemsOnMap.length; i++) {
                    if (this.itemsOnMap[i] == item._id) {
                        return true;
                    }
                }
                return false;
            },
            itemIndex: function(item) {
                for (var i = 0; i < this.itemsOnMap.length; i++) {
                    if (this.itemsOnMap[i] == item._id) {
                        return i;
                    }
                }
                return -1;

            },
            observers: [
                'statusChanged(status)',
                'newpoiChanged(newpoi)'
            ],
            properties: {
                callbackfunction: {
                    type: Object,
                },
                poiUrl: {
                    type: String,
                    notify: true,
                }

            },
            newpoiChanged: function(newpoi) {
                if (newpoi) {
                    this.$.ajaxLoader.generateRequest();

                }
            },
            statusChanged: function(stat) {
                if (stat.logged) {
                    this.$.ajaxLoader.generateRequest();

                }
            }
        });
    })();
    </script>
</dom-module>