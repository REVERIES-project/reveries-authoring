<link rel="import" href="../../../bower_components/polymer/polymer.html">
<link rel="import" href="../../../bower_components/iron-form/iron-form.html">
<link rel="import" href="../../../bower_components/iron-fit-behavior/iron-fit-behavior.html">
<link rel="import" href="../../../bower_components/paper-input/paper-input.html">
<link rel="import" href="../../../bower_components/iron-label/iron-label.html">
<link rel="import" href="../../../bower_components/paper-button/paper-button.html">
<link rel="import" href="../../../bower_components/paper-toast/paper-toast.html">
<link rel="import" href="../../../bower_components/paper-radio-group/paper-radio-group.html">
<link rel="import" href="../../../bower_components/paper-radio-button/paper-radio-button.html">
<link rel="import" href="../remove-ressource/remove-ressource.html">
<link rel="import" href="../helper/resource-header.html">
<link rel="import" href="../../../bower_components/iron-flex-layout/iron-flex-layout-classes.html">
<dom-module id="mcq-activity">
    <style is="custom-style" include="iron-flex iron-flex-alignment">
    .outer {
        display: inline-flex;
        flex-wrap: wrap;
        flex-direction: row;
    }
    
    .inner {
        display: inline-flex;
        flex-wrap: wrap;
        flex-direction: column;
    }
    
    .mcq-body {
        padding: 10px;
    }
    </style>
    <template>
        <remove-ressource id="remover" callbackfunction="{{mcqRemoved}}" ressource-id={{itemId}} ressource-url='/mcq'></remove-ressource>
        <div class=outer>
            <div class="inner">
                <resource-header resource-url="/mcq" resource-id="{{itemId}}" resource-status="{{resourceStatus}}" resource-readonly="{{resourceReadonly}}" resource-label="{{resourceLabel}}"></resource-header>
                <div id="mcqbody" class="mcq-body">
                    <template is="dom-if" if="{{needClue}}">
                        <img height="260px" src="/file/{{imageId}}">
                    </template>
                    <div class="question" name="question">{{question}}</div>
                    <paper-radio-group id="mcq" class="layout vertical wrap">
                        <paper-radio-button name="resp1">{{correctAnswer}}</paper-radio-button>
                        <paper-radio-button name="resp2">{{wrongAnswer1}}</paper-radio-button>
                        <paper-radio-button name="resp3">{{wrongAnswer2}}</paper-radio-button>
                    </paper-radio-group>
                    <paper-toast always-on-top id="correct" duration="0" class="fit-bottom" text="{{correctAnswerMessage}}"></paper-toast>
                    <paper-toast always-on-top id="wrong" duration="0" class="fit-bottom" text="{{wrongAnswerMessage}}"></paper-toast>
                    <div style="margin-top:40px" class="card-actions">
                        <paper-button raised on-click="validate">Validate</paper-button>
                        <paper-button disabled$="{{!imageId}}" raised on-click="getClue">Clue</paper-button>

                        <template is="dom-if" if="{{!isReadOnly}}">
                            <paper-button on-click="removeElement" raised>Suppress</paper-button>
                        </template>
                    </div>
                </div>
            </div>
        </div>
    </template>
    <script>
    (function() {
        'use strict';
        Polymer({
            is: 'mcq-activity',
            ready: function() {
                // this.hasClue=false
                this.mcqRemoved = function() {
                    this.fire('mcq-removed', null)
                }.bind(this)
                this.correctIndex=Math.floor((Math.random() * 2));
            },

            removeElement: function() {
                this.$.remover.genRequest();
            },

            getClue: function() {
                this.set('needClue', !this.needClue);
            },

            validate: function() {

                    if (this.$.mcq.selectedItem && this.$.mcq.selectedItem.innerText && this.$.mcq.selectedItem.innerText== this.correctAnswer) {
                        this.$.correct.open();
                    } else {
                        this.$.wrong.open();
                    }
            },
            _resourceReadonlyObserver: function(newval, oldval) {
                if (newval == "readonly") {
                    this.isReadOnly = true

                } else {
                    this.isReadOnly = false
                }
            },
            _resourceClueObserver: function(newval, oldval) {
                if (newval) {
                    this.set('hasClue', true)

                }
            },


            properties: {
                question: {
                    type: String,
                    notify: true,
                },
                correctAnswerMessage: {
                    type: String,
                    notify: true,
                },
                wrongAnswerMessage: {
                    type: String,
                    notify: true,
                },
                resourceStatus: {
                    type: String,
                    notify: true,
                },
                correctAnswer: {
                    type: String,
                    notify: true,
                },

                wrongAnswer1: {
                    type: String,
                    notify: true,
                },
                wrongAnswer2: {
                    type: String,
                    notify: true,
                },

                itemId: {
                    type: String,
                    notify: true
                },

                imageId: {
                    type: String,
                    notify: true,
                    observer: "_resourceClueObserver",
                },
                resourceLabel: {
                    type: String,
                    notify: true,
                },
                resourceReadonly: {
                    type: String,
                    notify: true,
                    observer: "_resourceReadonlyObserver",
                }
            }
        });
    })();
    </script>
</dom-module>
